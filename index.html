<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Imaginary Gifts ‚Äì Customised Catalogue</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Inter;background:#000;color:#fff}

/* HEADER */
.header{
  position:sticky;top:0;z-index:1000;
  background:#0b0b0b;
  padding:14px;
  text-align:center;
  font-weight:600;
  border-bottom:1px solid #222
}

/* CATEGORY BAR */
.category-bar{
  display:flex;gap:10px;
  overflow-x:auto;
  padding:10px;
}
.category-btn{
  padding:8px 14px;
  border-radius:20px;
  background:#222;
  font-size:13px;
  cursor:pointer;
  white-space:nowrap;
}
.category-btn.active{
  background:linear-gradient(45deg,#feda75,#fa7e1e,#d62976);
}

/* CONTAINER */
.container{max-width:480px;margin:auto;padding:14px}

/* CARD */
.card{
  background:#1c1c1c;
  border-radius:16px;
  padding:14px;
  margin-bottom:20px
}
.card h3{margin:0;font-size:16px}
.price{color:#f5e642;font-weight:600;margin-top:4px}

/* PRODUCT IMAGES */
.images{
  display:flex;
  gap:8px;
  overflow-x:auto;
  margin-top:10px
}
.images img{
  width:90px;height:90px;
  object-fit:cover;
  border-radius:10px;
  cursor:pointer
}

/* FORM */
label{
  font-size:12px;
  color:#aaa;
  margin-top:10px;
  display:block
}
input[type="text"], input[type="file"]{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:4px
}

/* UPLOAD PREVIEW */
.upload-preview{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:8px
}
.preview-box{
  position:relative
}
.preview-box img{
  width:70px;height:70px;
  border-radius:8px;
  object-fit:cover
}
.preview-box span{
  position:absolute;
  top:-6px;right:-6px;
  background:red;
  color:#fff;
  border-radius:50%;
  width:18px;height:18px;
  font-size:12px;
  text-align:center;
  line-height:18px;
  cursor:pointer
}

/* ORDER BUTTON */
.order-btn{
  margin-top:14px;
  background:#25D366;
  padding:14px;
  border-radius:30px;
  text-align:center;
  font-weight:600;
  cursor:pointer
}

/* FULLSCREEN IMAGE VIEWER */
#imgViewer{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:99999;
  align-items:center;
  justify-content:center
}
#imgViewer img{
  max-width:90%;
  max-height:90%;
  border-radius:12px
}

/* UPLOAD OVERLAY */
#uploadOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  z-index:99998;
  align-items:center;
  justify-content:center;
  flex-direction:column
}
.spinner{
  width:50px;height:50px;
  border:5px solid #333;
  border-top:5px solid #25D366;
  border-radius:50%;
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="header">üéÅ Imaginary Gifts ‚Äì Customised Catalogue</div>

<div class="category-bar" id="categoryBar"></div>
<div class="container" id="productContainer"></div>

<!-- IMAGE VIEWER -->
<div id="imgViewer" onclick="this.style.display='none'">
  <img id="viewerImg">
</div>

<!-- UPLOAD OVERLAY -->
<div id="uploadOverlay">
  <div class="spinner"></div>
  <p style="margin-top:16px">Uploading image‚Ä¶ Please wait</p>
</div>

<script>
const CLOUD_NAME="dpd2nhzrf";
const UPLOAD_PRESET="ig-upload";
const WHATSAPP_NUMBER="917385235738";

/* LOAD PRODUCTS */
fetch("products.json")
  .then(r=>r.json())
  .then(data=>initCatalogue(data));

function initCatalogue(products){
  const bar=document.getElementById("categoryBar");
  const keys=Object.keys(products);

  keys.forEach((cat,i)=>{
    const btn=document.createElement("div");
    btn.className="category-btn";
    btn.innerText=cat.toUpperCase();
    btn.onclick=()=>renderCategory(cat,products,false);
    bar.appendChild(btn);
  });

  // ‚úÖ DEFAULT LOAD
  renderCategory(keys[0],products,true);
}

function renderCategory(cat,products,firstLoad){
  document.getElementById("productContainer").innerHTML="";
  document.querySelectorAll(".category-btn").forEach(b=>b.classList.remove("active"));

  if(firstLoad){
    document.querySelectorAll(".category-btn")[0].classList.add("active");
  }else{
    event.target.classList.add("active");
  }

  products[cat].forEach(p=>{
    let imgs="";
    p.images.forEach(i=>{
      imgs+=`<img src="${i}" onclick="openImage(this)">`;
    });

    document.getElementById("productContainer").innerHTML+=`
      <div class="card">
        <h3>${p.name}</h3>
        <div class="price">‚Çπ ${p.price}</div>

        <div class="images">${imgs}</div>

        <label>Enter Text</label>
        <input type="text" placeholder="Name / Message">

        <label>Upload Images</label>
        <div class="image-upload-box">
          <input type="file" accept="image/*" onchange="handleUpload(this)">
        </div>
        <div class="upload-preview"></div>

        <div class="order-btn"
          onclick="orderNow(this,'${p.name}','${cat.toUpperCase()}','${p.price}')">
          Order on WhatsApp
        </div>
      </div>
    `;
  });
}

/* FULLSCREEN PRODUCT IMAGE */
function openImage(img){
  document.getElementById("viewerImg").src=img.src;
  document.getElementById("imgViewer").style.display="flex";
}

/* UPLOAD HANDLER (FIXED REMOVE ISSUE) */
function handleUpload(input){
  if(input.files.length===0)return;

  const card=input.closest(".card");
  const preview=card.querySelector(".upload-preview");
  const file=input.files[0];
  const url=URL.createObjectURL(file);

  const box=document.createElement("div");
  box.className="preview-box";

  const img=document.createElement("img");
  img.src=url;

  const remove=document.createElement("span");
  remove.innerText="√ó";
  remove.onclick=function(){
    box.remove();
    input.remove();
  };

  box.appendChild(img);
  box.appendChild(remove);
  preview.appendChild(box);

  const next=document.createElement("input");
  next.type="file";
  next.accept="image/*";
  next.style.marginTop="8px";
  next.onchange=function(){handleUpload(this)};
  input.parentElement.appendChild(next);
}

/* CLOUDINARY */
async function uploadToCloudinary(file){
  const fd=new FormData();
  fd.append("file",file);
  fd.append("upload_preset",UPLOAD_PRESET);

  const r=await fetch(
    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
    {method:"POST",body:fd}
  );
  return (await r.json()).secure_url;
}

/* ORDER */
async function orderNow(btn,product,category,price){
  const card=btn.closest(".card");
  const text=card.querySelector('input[type="text"]').value||"N/A";
  const inputs=card.querySelectorAll('input[type="file"]');

  document.getElementById("uploadOverlay").style.display="flex";

  let links=[];
  for(let i of inputs){
    if(i.files.length>0){
      links.push(await uploadToCloudinary(i.files[0]));
    }
  }

  document.getElementById("uploadOverlay").style.display="none";

  let msg=`Hi Imaginary Gifts üëã
Category: ${category}
Product: ${product}
Price: ‚Çπ${price}
Text: ${text}

Images:\n`;
  links.forEach((l,i)=>msg+=`${i+1}. ${l}\n`);

  window.open(
    "https://wa.me/"+WHATSAPP_NUMBER+"?text="+encodeURIComponent(msg),
    "_blank"
  );
}
</script>

</body>
</html>